dist: precise

env:
  global:
    secure: "CmbOINunx1Fqhr0RTworxsWUwiCCshGkSUzvHcjYlrkyiQ5pBhfmIZGZk3lpsO9QdmN2ciFotriXXbnRPXjx19fpAMkddBtK91eqaq55jsHVmr6aTLR0V1H7dtdyWueZZqB2iTzjbK3j5oBiTWyxl6M+oLGCBRbLqvwKMFn8+NJp3hzWAoiP+CpZJjsI7eTLBoVX22fZlQFjSpFeZnVSzFuOZ2PC8UcAUL27Dx7FUBSXqatkjxaXvFSJ3xnj7jdVT/C86VwlUu1Ra5q8J8RVKr/Qe1lvJpudHTkJsKSWGU/WSNfJF3pgRKl2Y1RxEFA9Ib2MosEyblWmO4+PRC7SpyrABM8mVlWwA0kPwLXm/ZZcOaH3knmmlQfV3IOMHeLgcADHRtD3S7WTAsa6gfINj7c04xi6Bm/0j03hgRGxtY3f6UnKjSYxogy3KEXVUE3R6c2LSHneG9xWAq9bqYoSR1uc5KkaQJh90AUGDcq0wfKbIlI6nXGvr2JRRnGT7guKsUZp54Enqmx5fwMVJ5YXJvDppMda1k9c4yIZ68KGS7Jm02vaOlIJd40xtXMV6xlpnfHLUlXr/n8pBWgeAMPAiOab1JOYqlbpv/7I97aBVt8V3L0Rm5dx/cusnVBDrB4sBGiJXDBQD1nRgK/C91LytcstfLHZdoPUdbwVYzYECmg="

stages:
  - test
  - deploy

before_install:
- openssl aes-256-cbc -K $encrypted_12c8071d2874_key -iv $encrypted_12c8071d2874_iv -in siwecosdeploy_rsa.enc -out siwecosdeploy_rsa -d

matrix:
  include:
    - language: php
      stage: test
      php: 7.2
      script:
        - composer selfupdate
        - composer install
        - ./vendor/bin/phpcs --extensions=php --standard=$(pwd)/vendor/joomla/coding-standards/Joomla src/modules
        - ./vendor/bin/phpcs --extensions=php --standard=$(pwd)/vendor/joomla/coding-standards/Joomla src/plugins

    - language: node_js
      stage: test
      node_js: lts/*
      script:
        - npm install
        - gulp parse-template-scss
        - gulp parse-critical-scss
        - find . -type f -exec curl --key siwecosdeploy_rsa --ftp-create-dirs -T {} sftp://${SFTP_HOST}/home/web4cshyx/html/siwecos.de{} \;


notifications:
  webhooks:
    on_success: change  # options: [always|never|change] default: always
    on_failure: always  # options: [always|never|change] default: always
    on_start: false     # default: false

sudo: required